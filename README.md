## Evothings Viewer

### Notice when building from source

Branch master contains updates not yet compatible with current production servers. When building a custom Evothings Viewer app from source, please use [the latest release](https://github.com/evothings/evothings-viewer/releases).

### Introduction

Evothings Viewer is the companion app for [Evothings Studio 2.0](https://github.com/evothings/evothings-studio/). It is used to connect to Evothings Workbench.

The app consists of a Cordova WebView, a number of useful plugins, and a UI to connect to Evothings Studio Workbench. You can edit the list of plugins in file package.json and build your custom version of the Viewer.

Evothings Viewer should not be confused with Evothings Client, which is the companion app for Evothings Studio 1.2. Evothings Viewer is used with the most recent Evothings Studio version (currently 2.0).

### Building the App

To build the app, you need Apache Cordova installed. Here are the build steps:

Download and unpack the source for the latest release:

    https://github.com/evothings/evothings-viewer/releases

Go to the downloaded and unpacked source directory:

    cd evothings-viewer

Add your platforms:

    cordova platform add android
    cordova platform add ios

Then build using Cordova:

    cordova build android
    cordova build ios

Plugins will be added automatically first time you add a platform.

You can edit [package.json](package.json) to configure which plugins you wish to be included. New plugins are added on next build.

To clean up the project run (removes platforms and plugins):

    node scripts/clean.js

You should do clean after having removed plugins from package.json.

### Build system overview

The build uses plain Cordova features (hooks and plugins) and is designed to be easy to use for people who know Cordova.

There are build hooks in the "scripts" directory, these are invoked to copy/modify files during the build process.

To make native application settings on Android and iOS a plugin in folder config/config-plugin is used. This plugin has no source files, it is there only to make project settings (a plugin can modify AndroidManifest.xml entries and info.plist entries, which cannot be done using config.xml).

Icons and launch screens are specified in config.xml.

Source code files in the config folder are copied to the target platform directory during build, for both Android and iOS. These source files contains special modifications for the Evothings app.

To clean the project use the command:

    node scripts/clean.js

This removes projects and plugins. Add platforms using "cordova platform add ...". Plugins are added when the project is built for the first time.

### Setting a custom package name

Change the package name in config.xml on this line:

    <widget id="com.evothings.evothingsviewer"

For Android, update this line in MainActivity.java to use your package name:

    package com.evothings.evothingsviewer;

Build for iOS not yet tested with custom package name.

### Known Xcode build issues

#### Bitcode must be turned off in Xcode

This is because the Estimote Beacon plugin bundled with Evothings Viewer does not support bitcode.

You need to manually turn off bitcode in the Xcode project generated by Cordova. Inside Xcode, go to "Build Settings" and set "Enable Bitcode" to "No".

#### On iOS *-info.plist items are duplicated on each Cordova build

Issue exists:

https://issues.apache.org/jira/browse/CB-9354

Fix exists:

https://github.com/apache/cordova-lib/pull/256

Workaround:

cordova platform rm ios
cordova platform add ios

The iOS project should now be "clean" and ready to build using Xcode.

#### On iOS *-info.plist items for interface orientations are deleted on Cordova build

No issue report known to exist.

Workaround:

cordova platform rm ios
cordova platform add ios

The iOS project should now be ready to build using Xcode. That is, do not build using "cordova build ios", because then the orientation settings are gone (you can add them manually in Xcode however).
